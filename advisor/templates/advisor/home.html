{% extends 'base.html' %}

{% block title %}Career Advisor â€” Chat{% endblock %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
    <!-- Sidebar -->
    <aside class="lg:col-span-1 bg-slate-800 rounded-lg p-4 border border-slate-700">
        <div class="flex items-center justify-between">
            <div>
                <h3 class="text-lg font-semibold text-emerald-300">Conversations</h3>
            </div>
            <div class="space-x-2">
                <a href="?new=1" class="text-sm px-2 py-1 bg-slate-700 rounded">New</a>
                <a href="?clear=1" class="text-sm px-2 py-1 bg-rose-600 rounded">Clear</a>
            </div>
        </div>

        <div class="mt-4 space-y-2 max-h-72 overflow-auto">
            {% for conv in conversations %}
                <a href="?conversation_id={{ conv.id }}" class="block p-2 rounded hover:bg-slate-700">
                    <div class="font-medium">{% if conv.title %}{{ conv.title }}{% else %}Conversation {{ conv.id }}{% endif %}</div>
                    <div class="text-xs text-slate-400">{{ conv.created_at|date:"M d, Y H:i" }}</div>
                </a>
            {% empty %}
                <div class="text-slate-400">No conversations yet</div>
            {% endfor %}
        </div>

        <div class="mt-4">
            <a href="{% url 'upload_cv' %}" class="inline-block w-full text-center bg-emerald-500 text-slate-900 py-2 rounded font-semibold">Upload CV</a>
        </div>
    </aside>

    <!-- Chat area -->
    <section class="lg:col-span-3 bg-slate-800 rounded-lg p-4 border border-slate-700 flex flex-col">
        <div class="flex-1 overflow-auto chat-scroll" id="messages">
            {% for msg in messages %}
                <div class="flex mb-3 {% if msg.sender == 'user' %}justify-end{% endif %}">
                    {% if msg.sender == 'user' %}
                        <div class="bg-emerald-400 text-slate-900 px-4 py-2 rounded-lg max-w-3/4">{{ msg.text }}</div>
                    {% else %}
                        <div class="bg-slate-700 text-slate-100 px-4 py-2 rounded-lg max-w-3/4">{{ msg.text|safe }}</div>
                    {% endif %}
                </div>
            {% empty %}
                <div class="text-slate-400">Start a conversation by typing a career interest below.</div>
            {% endfor %}
        </div>

        <form method="POST" id="chatForm" class="mt-4 flex gap-2">
            {% csrf_token %}
            <input id="userInput" name="user_input" class="flex-1 rounded px-4 py-2 bg-slate-900 border border-slate-700" autocomplete="off" placeholder="Type your message and press Enter..." required />
            <button type="submit" class="bg-emerald-500 text-slate-900 px-4 py-2 rounded">Send</button>
        </form>
    </section>
</div>
{% endblock %}

{% block scripts %}
<script>
    const messagesEl = document.getElementById('messages');
    if(messagesEl){ messagesEl.scrollTop = messagesEl.scrollHeight; }
    const form = document.getElementById('chatForm');
    const input = document.getElementById('userInput');
    input.addEventListener('keydown', function(e){ if(e.key === 'Enter' && !e.shiftKey){ e.preventDefault(); form.requestSubmit(); } });
</script>
{% endblock %}
