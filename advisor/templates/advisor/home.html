<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Career Advisor Bot</title>
    <style>
        :root{
            --bg: #0f1724;
            --panel: #0b1220;
            --accent: #7c5cff;
            --muted: #94a3b8;
            --user: linear-gradient(135deg,#0ea5a4,#34d399);
            --ai: linear-gradient(135deg,#1e3a8a,#60a5fa);
        }
        html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,#071126 0%, #081428 60%);color:#e6eef8}
        .chat-wrap{width:100%;max-width:1000px;margin:28px auto;padding:18px}
        .chat-app{display:flex;gap:18px}
        .sidebar{width:260px;background:var(--panel);border-radius:12px;padding:12px;box-shadow:0 6px 24px rgba(2,6,23,.6)}
        .main{flex:1;background:var(--panel);border-radius:12px;padding:18px;display:flex;flex-direction:column;min-height:520px}
        .brand{font-weight:700;color:var(--accent);margin-bottom:12px}
        .history-list{max-height:420px;overflow:auto;margin-top:8px}
        .history-item{padding:8px;border-radius:8px;color:#cfe8ff;margin-bottom:8px;background:transparent;display:block;text-decoration:none}
        .history-item small{display:block;color:var(--muted);font-size:12px}

        .chat-window{flex:1;display:flex;flex-direction:column}
        .messages{flex:1;overflow:auto;padding:12px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent)}
        .msg{display:flex;margin:8px 0;align-items:flex-end}
        .msg.user{justify-content:flex-end}
        .bubble{max-width:78%;padding:12px;border-radius:12px;color:#071126}
        .bubble.user{background:var(--user);color:white;border-bottom-right-radius:4px}
        .bubble.ai{background:var(--ai);color:white;border-bottom-left-radius:4px}
        .meta{font-size:11px;color:var(--muted);margin-top:6px}

        .composer{display:flex;gap:8px;margin-top:12px}
        .input{flex:1;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
        .send{background:var(--accent);color:white;border:none;padding:10px 14px;border-radius:10px;cursor:pointer}
        .send:active{transform:translateY(1px)}

        .ai-heading{margin:8px 0 6px;color:#dbeafe}
        .ai-bullets{margin:6px 0 6px 18px}
        .ai-bullets li{margin:4px 0}

        @media(max-width:820px){.chat-app{flex-direction:column}.sidebar{width:100%}.main{min-height:420px}}
    </style>
</head>
<body>
<div class="chat-wrap">
    <div class="chat-app">
        <div class="sidebar">
            <div style="display:flex;justify-content:space-between;align-items:center">
                <div class="brand">⚡ Career Advisor</div>
                <div style="font-size:13px;color:var(--muted)">
                    {{ request.user.username }} |
                    <form method="post" action="/accounts/logout/" style="display:inline">
                        {% csrf_token %}
                        <button type="submit" style="background:none;border:none;color:#ff9b9b;cursor:pointer;padding:0;font-size:13px">Logout</button>
                    </form>
                </div>
            </div>
            <div style="display:flex;gap:8px;margin-bottom:8px">
                <a class="history-item" href="?new=1" style="color:#bde0ff;display:inline-block;">+ New</a>
                <a class="history-item" href="?clear=1" style="color:#ff9b9b;display:inline-block;">Clear All</a>
            </div>
            <div class="history-list">
                {% for conv in conversations %}
                    <a class="history-item" href="?conversation_id={{ conv.id }}">
                        {% if conv.title %}{{ conv.title }}{% else %}Conversation {{ conv.id }}{% endif %}
                        <small>{{ conv.created_at|date:"M d, Y H:i" }}</small>
                    </a>
                {% empty %}
                    <div style="color:var(--muted)">No conversations yet</div>
                {% endfor %}
            </div>
        </div>

        <div class="main">
            <div class="chat-window">
                <div class="messages" id="messages">
                    {% for msg in messages %}
                        <div class="msg {% if msg.sender == 'user' %}user{% else %}ai{% endif %}">
                            {% if msg.sender == 'user' %}
                                <div class="bubble user">{{ msg.text }}</div>
                            {% else %}
                                <div class="bubble ai">{{ msg.text|safe }}</div>
                            {% endif %}
                        </div>
                    {% empty %}
                        <div class="msg ai">
                            <div class="bubble ai">Hello — please enter which career you are interested in.</div>
                        </div>
                    {% endfor %}
                </div>

                <form method="POST" id="chatForm" class="composer">
                    {% csrf_token %}
                    <input id="userInput" name="user_input" class="input" autocomplete="off" placeholder="Type your message and press Enter..." required />
                    <button type="submit" class="send">Send</button>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    // Auto-scroll to bottom
    const messagesEl = document.getElementById('messages');
    if(messagesEl){ messagesEl.scrollTop = messagesEl.scrollHeight; }

    // Submit on Enter
    const form = document.getElementById('chatForm');
    const input = document.getElementById('userInput');
    input.addEventListener('keydown', function(e){
        if(e.key === 'Enter' && !e.shiftKey){
            e.preventDefault();
            form.requestSubmit();
        }
    });
</script>
</body>
</html>
